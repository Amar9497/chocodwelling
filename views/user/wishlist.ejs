<%- include('navbar') %>
<%- include('alert') %>

<div class="container mx-auto px-4 py-8 min-h-screen">
  <% if (products.length != 0) { %>
    <!-- Wishlist Header -->
    <div class="flex flex-wrap justify-between items-center mb-8 border-b border-gray-200 pb-4">
      <div class="flex items-center gap-3">
        <h3 class="text-3xl font-bold text-gray-800">My Wishlist</h3>
        <span class="px-3 py-1 bg-gray-100 text-gray-600 rounded-full text-sm font-medium">
          <%= products.length %> items
        </span>
      </div>
      <p class="text-gray-500 text-sm mt-2 md:mt-0">Save your favorite items for later</p>
    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
      <% products.forEach((product) => { %>
        <div class="group bg-white rounded-xl shadow-sm hover:shadow-md transition-all duration-300 overflow-hidden">
          <!-- Product Image Container -->
          <div class="relative aspect-square overflow-hidden">
            <a href="/productDetail/<%= product.productID.id %>" class="block">
              <img
                src="<%= product.productID.productImage[0] %>"
                alt="<%= product.productID.productName %>"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
              />
            </a>
            <!-- Delete Button -->
            <button 
              class="delete-link absolute top-3 right-3 p-2 bg-white/80 backdrop-blur-sm rounded-full 
                     shadow-sm hover:bg-red-50 transition-colors duration-200"
              data-id="<%= product.productID._id %>"
            >
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" 
                   stroke-width="1.5" stroke="currentColor" class="w-5 h-5 text-red-500">
                <path stroke-linecap="round" stroke-linejoin="round" 
                      d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
              </svg>
            </button>
          </div>

          <!-- Product Details -->
          <div class="p-4">
            <a href="/productDetail/<%= product.productID.id %>" class="block">
              <h3 class="text-lg font-semibold text-gray-800 line-clamp-1 mb-2">
                <%= product.productID.productName %>
              </h3>
              <p class="text-gray-600 text-sm line-clamp-2 mb-3 h-10">
                <%= product.productID.productDescription %>
              </p>
              <div class="flex items-center justify-between">
                <span class="text-xl font-bold text-blue-600">
                  ₹<%= product.productID.productVariants[0].price %>
                </span>
                <button class="text-blue-600 hover:text-blue-700 text-sm font-medium">
                  View Details →
                </button>
              </div>
            </a>
          </div>
        </div>
      <% }) %>
    </div>

  <% } else { %>
    <!-- Empty Wishlist State -->
    <div class="text-center py-16 px-4">
      <div class="max-w-md mx-auto">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" 
             stroke-width="1.5" stroke="currentColor" class="w-16 h-16 mx-auto text-gray-400 mb-6">
          <path stroke-linecap="round" stroke-linejoin="round" 
                d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" />
        </svg>

        <h2 class="text-2xl md:text-3xl font-bold text-gray-800 mb-4">
          Your wishlist is empty!
        </h2>
        <p class="text-gray-600 text-lg mb-8">
          Your wish is Our Wish, Add products to Wishlist.
        </p>
        <a href="/home" 
           class="inline-flex items-center px-6 py-3 bg-blue-600 text-white font-medium 
                  rounded-lg hover:bg-blue-700 focus:ring-4 focus:ring-blue-300 
                  transition-colors duration-300">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" 
               stroke-width="1.5" stroke="currentColor" class="w-5 h-5 mr-2">
            <path stroke-linecap="round" stroke-linejoin="round" 
                  d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
          </svg>
          Start Shopping
        </a>
      </div>
    </div>
  <% } %>
</div>

<%- include('footer') %>

<script>
  document.addEventListener("DOMContentLoaded", (event) => {
    document.querySelectorAll(".delete-link").forEach((element) => {
      element.addEventListener("click", function (e) {
        e.preventDefault();
        const productId = this.getAttribute("data-id");
        Swal.fire({
          title: "Are you sure?",
          text: "Do you want to remove this item from the Wishlist?",
          icon: "warning",
          showCancelButton: true,
          confirmButtonColor: "#3085d6",
          cancelButtonColor: "#d33",
          confirmButtonText: "Yes, delete it!",
        }).then((result) => {
          if (result.isConfirmed) {
            fetch(`/delete-wish/${productId}`, {
              method: "DELETE",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({ productId }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  Swal.fire("Deleted!", data.message, "success").then(() => {
                    window.location.reload();
                  });
                } else {
                  Swal.fire("Error", data.message, "error");
                }
              })
              .catch((error) => {
                Swal.fire(
                  "Error",
                  "There was a problem deleting the item.",
                  "error"
                );
              });
          }
        });
      });
    });
  });
</script>
